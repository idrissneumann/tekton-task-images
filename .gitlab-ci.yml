stages:
  - mirror
  - publish

github-mirror:
  stage: mirror
  script:
    - setsid ./ci/github-mirror.sh
  only:
    - /^(master.*)$/
  tags:
    - tekton-utils

init-pipeline-github:
  stage: publish
  script:
    - setsid ./ci/docker-deliver.sh "init-pipeline-github" "1.6"
  only:
    refs:
      - /^(master.*)$/
    changes:
      - init-pipeline-github/*
      - git-fetch-sources/*
      - github-add-comment/*
      - github-set-status/*
      - slack-sender/*
  tags:
    - tekton-utils

yarn-ci-node14:
  stage: publish
  script:
    - setsid ./ci/docker-deliver.sh "yarn-ci-node14" "1.1"
  only:
    refs:
      - /^(master.*)$/
    changes:
      - yarn-ci/*
  tags:
    - tekton-utils

yarn-ci-node12:
  stage: publish
  script:
    - setsid ./ci/docker-deliver.sh "yarn-ci-node12" "1.1"
  only:
    refs:
      - /^(master.*)$/
    changes:
      - yarn-ci/*
  tags:
    - tekton-utils

destroy-pvc:
  stage: publish
  script:
    - setsid ./ci/docker-deliver.sh "destroy-pvc" "1.2"
  only:
    refs:
      - /^(master.*)$/
    changes:
      - init-kube-config/*
      - destroy-pvc/*
  tags:
    - tekton-utils

destroy-pods:
  stage: publish
  script:
    - setsid ./ci/docker-deliver.sh "destroy-pods" "1.2"
  only:
    refs:
      - /^(master.*)$/
    changes:
      - init-kube-config/*
      - destroy-pods/*
  tags:
    - tekton-utils

kaniko-build:
  stage: publish
  script:
    - setsid ./ci/docker-deliver.sh "kaniko-build" "1.0"
  only:
    refs:
      - /^(master.*)$/
    changes:
      - kaniko-build/*
  tags:
    - tekton-utils

slack-sender:
  stage: publish
  script:
    - setsid ./ci/docker-deliver.sh "slack-sender" "1.0"
  only:
    refs:
      - /^(master.*)$/
    changes:
      - slack-sender/*
  tags:
    - tekton-utils

slack-result-sender:
  stage: publish
  script:
    - setsid ./ci/docker-deliver.sh "slack-result-sender" "1.2"
  only:
    refs:
      - /^(master.*)$/
    changes:
      - slack-result-sender/*
  tags:
    - tekton-utils

github-search-pr:
  stage: publish
  script:
    - setsid ./ci/docker-deliver.sh "github-search-pr" "1.0"
  only:
    refs:
      - /^(master.*)$/
    changes:
      - github-search-pr/*
  tags:
    - tekton-utils

github-set-status:
  stage: publish
  script:
    - setsid ./ci/docker-deliver.sh "github-set-status" "1.0"
  only:
    refs:
      - /^(master.*)$/
    changes:
      - github-set-status/*
  tags:
    - tekton-utils

github-add-comment:
  stage: publish
  script:
    - setsid ./ci/docker-deliver.sh "github-add-comment" "1.0"
  only:
    refs:
      - /^(master.*)$/
    changes:
      - github-add-comment/*
  tags:
    - tekton-utils

github-webhook:
  stage: publish
  script:
    - setsid ./ci/docker-deliver.sh "github-webhook" "1.0"
  only:
    refs:
      - /^(master.*)$/
    changes:
      - github-webhook/*
  tags:
    - tekton-utils

generate-certificate:
  stage: publish
  script:
    - setsid ./ci/docker-deliver.sh "generate-certificate" "1.0"
  only:
    refs:
      - /^(master.*)$/
    changes:
      - generate-certificate/*
  tags:
    - tekton-utils

git-fetch-sources:
  stage: publish
  script:
    - setsid ./ci/docker-deliver.sh "git-fetch-sources" "1.0"
  only:
    refs:
      - /^(master.*)$/
    changes:
      - git-fetch-sources/*
  tags:
    - tekton-utils

state-success:
  stage: publish
  script:
    - setsid ./ci/docker-deliver.sh "state-success" "1.0"
  only:
    refs:
      - /^(master.*)$/
    changes:
      - state-success/*
  tags:
    - tekton-utils

